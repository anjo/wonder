<html>
<head>
<title>Rapid turnaround mode For WO 5</title>
</head>
<body bgcolor=white>
<h1>Warning: this documentation is not yet updated to the inclusion into the ERExtensions</h1>
<p>Changes so far:<ul>
<li>CP is disabled by default 
<li>CP is disabled when you enable caching 
<li>in your WebObjects.properties add a line<br><code>er.extensions.ERXCompilerProxyEnabled=true</code>
<li>For best results, you should set your "JAVA_ARCHIVE_CLASSES=NO" in your development targets settings, 
that way, the freshly compiled classes will overwrite the older ones.
</ul>
<p>To generate the <code>CPFileList.txt</code> add a shell build phase with 
<code>sh "/Library/Frameworks/ERExtensions.framework/Resources/InstallCompilerProxySupport.sh"</code>
</p>
<p>Please direct any questions to ak@prnet.de.</p>

<hr>
<h2>Old docs from here on</h2>
<h1>CompilerProxy Framework</h1>

<p>(c) 2001, Anjo Krank (<a href="mailto:ak@prnet.de">ak@prnet.de</a>), all rights reserved</p>
<p>Homepage: <a href="http://www.prnet.de/RegEx/cp.html">http://www.prnet.de/RegEx/cp.html</a></p>
<p>Download: <a href="http://www.prnet.de/RegEx/cp.tgz">http://www.prnet.de/RegEx/cp.tgz</a>, <a href="http://www.prnet.de/RegEx/log4j.tgz">http://www.prnet.de/RegEx/log4j.tgz</a></p>


<h2>About</h2>

<p>Ever got tired of the long time WO 5 takes to rebuild your project 
after every tiny change you make? Ever got really tired because you had to 
build/install those frameworks every ten minutes? Not afraid of living 
on the edge? Then this framework is for you!</p>

<p>CompilerProxy is a framework that creates a rapid-turnaround mode for WebObjects 5 
for Java similar to how you use WebScript with WO 4.5.1.  Instead of 
recompiling your Application or Frameworks, you simply change the source code 
in question and reload your page. In some cases, you may also have to restart 
your Application but you won't have to rebuild it.</p>

<p>CompilerProxy is especially well suited for DirectToWeb applications. The restrictions of Java's classloading are partially compensated by the highly dynamic nature of D2W apps.</p>

<h2>Installation</h2>
<p>Copy CompilerProxy.framework and Log4J.framework to your /Library/Frameworks 
Folder. Also, check if you have jikes installed in /usr/bin.</p>

<h2>Usage</h2>
<p>To use this framework you must complete a few easy steps and you will very seldom have to rebuild your project again:</p>
    <ul>
    <li>Add CompilerProxy.framework and Log4J.framework to your project<br><br>
    <li>Then <b>either</b> create a file named <code>CPFileList.txt</code> in your project's and your framework's source directory. This file should contain lines with "<code>./project_relative_path_to_Someclass.java:package_of_SomeClass_or_empty&lt;return&gt;</code>" for every file you want to get recompiled. You do not need to add the CompilerProxy.framework to your framework projects only to the final application.
    <br><br>
    <li><b>or</b> create a new shell build phase right after the "Frameworks &amp; Libraries":</p>
    <ol>
	<li> Set the current target to your app
	<li> Click on "Files &amp; Build Phases" tab
	<li> Choose "Project/New Build Phase/New Shell Script Build Phase" from the Menu 
	    and drag the build phase right after the "Frameworks &amp; Libraries"
	<li> Insert the code <code><pre>sh "/Library/Frameworks/CompilerProxy.framework/Resources/InstallCompilerProxySupport.sh"</pre></code>
    </ol>
    <b>NOTE:</b> I'm not sure about the real workings of the build process in the new Project Builder. All I can say is that this works for me...<br>Now, everytime you build this project, every source file directly under the project directory will be put into the <code>CPFileList.txt</code> file.<br>
</ul>
<p>When the time for deployment comes, simply remove the framework from your build and you're done.</p>

<h2>What it does</h2>
<p>The framework does several things to works it's magic. First, on startup, it registers for the <code>ApplicationDidFinishLaunching</code> Notification. When the App starts, it reads the <code>CPFileList.txt</code> files from your <b>currently opened</b> projects to find out about the files to watch. So remember to have your framework projects open in PB.</p>
<p>It also registers for the <code>ApplicationWillDispatchRequest</code> Notification, which gets triggered whenever a page is requested. It tries to compile the files that have changed and throws an Exception describing the errors if there where any and then aborts further handling of the request - you will get an error from your browser. However, if everything went well, it creates a new ClassLoader and throws away the component definition cache. Then, when the next "pageWithName" is called, the updated class will be used.</p>
<p>This is slightly different from how WebScript handled things. In Java, you simply can't change an Object's class implementation at runtime - so if you already have a page (or any other Object) this object will not use the newer class. Only Objects created after the compilation will have new behaviour.</p>
<p>The freshly compiled files will be put into your App's <code>Resources/Java</code> directory into the proper package hierarchy. So, if you simply restart your App, the newer files will be used. When you re-build your project, your normal <code>.jar</code> will contains the correct classes anyway.</p>
<p><b>NOTE:</b> Since all new class files end up in <code>Resources/Java</code>, when you clean-build your App, you also need to recompile your frameworks! A normal build will not delete the files, so recompilation of the frameworks is not needed.</p>

<h2>Knows bugs and limitations</h2>
<ul>
<li>Since Java can't redefine objects, the new code will get used only for new objects. you may either have to reload multiple times or start a new session to get things to work.

<li>You may see an error <code>"IllegalAccess in KeyValueCodingProtectedAccessor"</code>. You will probably have defined a new variable in your component with protected access. Either set the scope of the variable to public or restart your app.

<li>You must have the respective projects opened in Project Builder. If you don't, CP can't find the sources.

<li>You should not modify multiple files at once, or - if you really have to - at least don't have the changes depend on each other.

<li>You must reload after making changes and before stopping your application, because the file modification times 
are read only at start. If you stop the application before reloading, your 
last changes will not be recognized.

<li>Changes in the Application, DirectAction and stateless Component classes (among others) will not be 
recognized before a restart. They are only read once, due to the nature of Java's class loading and can't be fixed. 
<li>If you make changes in your EO's classes, you should definitely restart your 
application after pressing reload. You may seriously mess up your data if you have a mix of previously instaniated Objects and new ones.
</ul>

<h2>License</h2>

<p>I would like to know if and how you use it and you could offer me a beer if we meet at next WWDC. 
Apart from that, you may pretty much what you want.</p>

<p>Of course, this code is highly experimental. It may toast your goldfish for all 
I know, so you are on your own if you run into trouble. </p>

<!--<h2>Thanks</h2>

<p>None so far. Be sure to be the first to get mentioned!</p>-->

<h2>Version History</h2>

<p>12/06/01 - 1.4 included in ERExtensions, renamed to ERXCompilerProxy.</p>
<p>12/06/01 - 1.3 fixed several bugs, added framework turnaround support.</p>
<p>07/26/01 - 1.2 fixed several bugs, vastly simplified installation. Removed the need to clean your project.</p>
<p>07/08/01 - 1.0 initial release</p>
</body>
</html>
