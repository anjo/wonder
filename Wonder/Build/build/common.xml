<project name="common" default="all" basedir="../..">

    <target name="properties">
        <property name="framework.name" value="${project.name}.framework" />
        <property name="build.classes" value="${build.root}/classes/${project.name}" />
        <property name="build.framework.dir" value="${build.root}/${framework.name}" />
        <property name="build.jar.file" value="${build.framework.dir}/Resources/Java/${project.name}.jar" />
        <property name="build.temp.dir" value="${build.root}/tmp$" />

        <path id="project.class.path">
            <fileset dir="${build.root}">
                <include name="ER*.framework/Resources/Java/*.jar" />
                <include name="BT*.framework/Resources/Java/*.jar" />
            </fileset>
            <fileset dir="${wo.woroot}/Library/Frameworks">
                <include name="Java**/Resources/Java/*.jar" />
                <exclude name="JavaWOExtensions.framework"/>
            </fileset>
        </path>
    </target>

    <target name="usage">
        <echo message="-------------------------------------" />
        <echo message="Valid target-commands" />
        <echo message="---------------------" />
        <echo message="  all       --> create framework in ${build.root} " />
        <echo message="  install   --> copy framework to ${wo.localroot} " />
        <echo message="  web       --> copy framework to ${wo.server.root} " />
        <echo message="  clean     --> remove .classes and .framework" />
        <echo message="  allclean  --> remove .classes and .framework and installed framework" />
        <echo message="--------------------------------------" />
    </target>

    <target name="prepare" depends="properties">
        <mkdir dir="${project.dir}/Libraries" />
        <mkdir dir="${project.dir}/Sources" />
        <mkdir dir="${project.dir}/Resources" />
        <mkdir dir="${project.dir}/Components" />
        <mkdir dir="${project.dir}/WebServerResources" />
        <mkdir dir="${build.root}" />
        <mkdir dir="${build.classes}" />
    </target>

    <target name="compile" depends="prepare" description="Default compile target">
        <mkdir dir="${build.classes}" />
        <javac srcdir="${project.dir}/Sources" destdir="${build.classes}" debug="on" optimize="off" deprecation="on">
            <classpath> 
                <fileset dir="${project.dir}/Libraries">
                    <include name="**/*.jar" />
                </fileset>
                <path refid="project.class.path" />
            </classpath>
        </javac>
    </target>

    <target name="framework" depends="properties,compile" description="Default compile target">

        <mkdir dir="${build.framework.dir}" />
        <taskdef name="woframework" classname="org.objectstyle.woproject.ant.WOFramework">
            <classpath refid="project.class.path" />
        </taskdef>
        <woframework name="${project.name}" destDir="${build.root}" principalClass="${project.principal.class}" jarName="${project.name}">
            <lib dir="${project.dir}/Libraries">
                <include name="**/*.jar" />
            </lib>
            <classes dir="${build.classes}">
                <include name="**/*.class" />
            </classes>
            <resources dir="${project.dir}/Components">
                <include name="**.api" />
                <include name="**/*.wo/**" />
            </resources>
            <resources dir="${project.dir}/Resources">
                <include name="*.eomodeld/**" />
                <include name="**/*.plist" />
                <include name="**/*.d2wmodel" />
                <include name="**/Properties" />
                <include name="**/*.strings" />
                <include name="**/*.sh" />
                <include name="**/mime.types" /> <!-- ERJavaMail specific --> 
            </resources>
            <wsresources dir="${project.dir}/WebServerResources">
                <include name="**/*.gif" />
                <include name="**/*.jpeg" />
                <include name="**/*.js" />
                <include name="**/*.css" />
            </wsresources>
        </woframework>
        <exec dir="${project.dir}" executable="/bin/sh" os="Mac OS X">
            <arg line="${build.root}/ERJars.framework/Resources/CPCreateFileList.sh" />
        </exec>
 
        <echo message="-------------------------------------" />
        <echo message="${project.name}.framework" />
        <echo message="-------------------------------------" />
    </target>

    <target name="application" depends="properties, compile" description="Default compile target">

        <taskdef name="woapplication" classname="org.objectstyle.woproject.ant.WOApplication">
            <classpath refid="project.class.path" />
        </taskdef>
        <woapplication name="${project.name}" destDir="${build.root}" principalClass="${project.principal.class}" jarName="${project.name}" stdFrameworks="false">
            <classes dir="${build.classes}">
                <include name="**/*.class" />
            </classes>
            <resources dir="${project.dir}/Components">
                <include name="**.api" />
                <include name="**/*.wo/**" />
            </resources>
            <resources dir="${project.dir}/Resources">
                <include name="*.eomodeld/**" />
                <include name="**/*.plist" />
                <include name="**/*.d2wmodel" />
                <include name="**/Properties" />
                <include name="**/*.strings" />
                <include name="**/*.sh" />
            </resources>
            <wsresources dir="${project.dir}/WebServerResources">
                <include name="**/*.gif" />
                <include name="**/*.jpeg" />
                <include name="**/*.js" />
                <include name="**/*.css" />
            </wsresources>
            <frameworks root="${build.root}" if="core.set">
                <include name="JavaWO*.framework"/>
                <include name="ER*.framework"/>
                <include name="BT*.framework"/>
                <exclude name="ERNeutralLook.framework"/>
                <exclude name="ERJavaMail.framework"/>
                <exclude name="ERChangeNotificationJMS.framework"/>
                <exclude name="WOPayPal.framework"/>
                <exclude name="Validity.framework"/>
            </frameworks>
            <frameworks root="${wo.woroot}">
                <include name="Library/Frameworks/JavaJDBCAdaptor.framework" />
                <include name="Library/Frameworks/JavaXML.framework"/>
                <include name="Library/Frameworks/JavaEOControl.framework" />
                <include name="Library/Frameworks/JavaWebObjects.framework" />
                <include name="Library/Frameworks/JavaDirectToWeb.framework" />
                <include name="Library/Frameworks/JavaEOProject.framework" />
                <include name="Library/Frameworks/JavaEOAccess.framework" />
                <include name="Library/Frameworks/JavaFoundation.framework" />
                <include name="Library/Frameworks/JavaDTWGeneration.framework" />
            </frameworks>
            <frameworks root="${wo.localroot}">
                <include name="Library/Frameworks/Mysql*.framework"/>
            </frameworks>
        </woapplication>
        <exec dir="${project.dir}" executable="/bin/sh" os="Mac OS X">
            <arg line="${build.root}/ERJars.framework/Resources/CPCreateFileList.sh" />
        </exec>

        <echo message="-------------------------------------" />
        <echo message="${project.name}.woa" />
        <echo message="-------------------------------------" />
    </target>

    <target name="stepwiseApplication" depends="properties, compile" description="Default compile target">
        <taskdef name="woapplication" classname="org.objectstyle.woproject.ant.WOApplication">
            <classpath refid="project.class.path" />
        </taskdef>
        <woapplication name="${project.name}" destDir="${build.root}" principalClass="${project.principal.class}" jarName="${project.name}" stdFrameworks="false">
            <classes dir="${build.classes}">
                <include name="**/*.class" />
            </classes>
            <resources dir="${project.dir}/Components">
                <include name="**.api" />
                <include name="**/*.wo/**" />
            </resources>
            <resources dir="${project.dir}/Resources">
                <include name="*.eomodeld/**" />
                <include name="**/*.plist" />
                <include name="**/*.d2wmodel" />
                <include name="**/Properties" />
                <include name="**/*.strings" />
                <include name="**/*.sh" />
            </resources>
            <wsresources dir="${project.dir}/WebServerResources">
                <include name="**/*.gif" />
                <include name="**/*.jpeg" />
                <include name="**/*.js" />
                <include name="**/*.css" />
            </wsresources>
            <frameworks root="${wo.woroot}">
                <include name="Library/Frameworks/JavaFoundation.framework" />
                <include name="Library/Frameworks/JavaEOControl.framework" />
                <include name="Library/Frameworks/JavaEOAccess.framework" />
                <include name="Library/Frameworks/JavaWebObjects.framework" />
                <include name="Library/Frameworks/JavaWOExtensions.framework" />
                <include name="Library/Frameworks/JavaXML.framework" />
                <include name="Library/Frameworks/JavaJDBCAdaptor.framework" />
                <include name="Library/Frameworks/JavaDirectToWeb.framework" />
                <include name="Library/Frameworks/JavaDTWGeneration.framework" />
                <include name="Library/Frameworks/JavaEOProject.framework" />
            </frameworks>
        </woapplication>

    <echo message="-------------------------------------" />
    <echo message="${project.name}.woa" />
    <echo message="-------------------------------------" />
    </target>

    <target name="install" depends="all">
        <copy todir="${wo.localroot}/${framework.name}">
            <fileset dir="${build.framework.dir}" />
        </copy>
    </target>

    <target name="web" depends="framework">
        <copy todir="${wo.server.root}/${framework.name}/WebServerResources">
            <fileset dir="${build.framework.dir}/WebServerResources" />
        </copy>
    </target>
	
    <target name="clean" depends="properties">
        <echo message="-------------------------------------" />
        <echo message="${project.dir}" />
        <echo message="-------------------------------------" />
        <delete dir="${build.classes}" />
        <delete dir="${build.framework.dir}" />
    </target>
    
    <!-- ERJars -->
    <!-- (ak) ERJars is handled separately because it needs to copy the compiler proxy files first -->
    <target name="ERJars.all">
        <property name="project.dir" value="${wonder.root}/Common/Frameworks/ERJars" />
        <taskdef name="woframework" classname="org.objectstyle.woproject.ant.WOFramework">
        </taskdef>
        <woframework name="ERJars" destDir="${build.root}" principalClass="" jarName="ERJars">
            <lib dir="${project.dir}/Libraries">
                <include name="**/*.jar" />
            </lib>
            <resources dir="${project.dir}/Resources">
                <include name="**/*.sh" />
            </resources>
        </woframework>
    </target>
    <target name="ERJars.clean">
        <antcall target="clean" >
            <param name="project.principal.class" value="" />
            <param name="project.name" value="ERJars" />
            <param name="project.dir" value="${wonder.root}/Common/Frameworks/ERJars" />
        </antcall>
    </target>
    
    <!-- JavaWOExtensions -->
    <target name="JavaWOExtensions.all">
        <antcall target="framework" >
            <param name="project.principal.class" value="" />
            <param name="project.name" value="JavaWOExtensions" />
            <param name="project.dir" value="${wonder.root}/Common/Frameworks/JavaWOExtensions" />
        </antcall>
    </target>
    <target name="JavaWOExtensions.clean">
        <antcall target="clean" >
            <param name="project.principal.class" value="" />
            <param name="project.name" value="JavaWOExtensions" />
            <param name="project.dir" value="${wonder.root}/Common/Frameworks/JavaWOExtensions" />
        </antcall>
    </target>

    <!-- ERExtensions -->
    <target name="ERExtensions.all">
        <antcall target="framework" >
            <param name="project.principal.class" value="er.extensions.ERXExtensions" />
            <param name="project.name" value="ERExtensions" />
            <param name="project.dir" value="${wonder.root}/Common/Frameworks/ERExtensions" />
        </antcall>
    </target>
    <target name="ERExtensions.clean">
        <antcall target="clean" >
            <param name="project.principal.class" value="er.extensions.ERXExtensions" />
            <param name="project.name" value="ERExtensions" />
            <param name="project.dir" value="${wonder.root}/Common/Frameworks/ERExtensions" />
        </antcall>
    </target>
    
    <!-- ERDirectToWeb -->
    <target name="ERDirectToWeb.all">
        <antcall target="framework" >
            <param name="project.principal.class" value="er.directtoweb.ERDirectToWeb" />
            <param name="project.name" value="ERDirectToWeb" />
            <param name="project.dir" value="${wonder.root}/Common/Frameworks/ERDirectToWeb" />
        </antcall>
    </target>
    <target name="ERDirectToWeb.clean">
        <antcall target="clean" >
            <param name="project.principal.class" value="er.directtoweb.ERDirectToWeb" />
            <param name="project.name" value="ERDirectToWeb" />
            <param name="project.dir" value="${wonder.root}/Common/Frameworks/ERDirectToWeb" />
        </antcall>
    </target>
    
    <!-- ERCoreBusinessLogic -->
    <target name="ERCoreBusinessLogic.all">
        <antcall target="framework" >
            <param name="project.principal.class" value="er.corebusinesslogic.ERCoreBusinessLogic" />
            <param name="project.name" value="ERCoreBusinessLogic" />
            <param name="project.dir" value="${wonder.root}/Common/Frameworks/ERCoreBusinessLogic" />
        </antcall>
    </target>
    <target name="ERCoreBusinessLogic.clean">
        <antcall target="clean" >
            <param name="project.principal.class" value="er.corebusinesslogic.ERCoreBusinessLogic" />
            <param name="project.name" value="ERCoreBusinessLogic" />
            <param name="project.dir" value="${wonder.root}/Common/Frameworks/ERCoreBusinessLogic" />
        </antcall>
    </target>
    
    <!-- ERJavaMail -->
    <target name="ERJavaMail.all">
        <antcall target="framework" >
            <param name="project.principal.class" value="er.javamail.ERJavaMail" />
            <param name="project.name" value="ERJavaMail" />
            <param name="project.dir" value="${wonder.root}/Common/Frameworks/ERJavaMail" />
        </antcall>
    </target>
    <target name="ERJavaMail.clean">
        <antcall target="clean" >
            <param name="project.principal.class" value="Application" />
            <param name="project.name" value="ERJavaMail" />
            <param name="project.dir" value="${wonder.root}/Common/Frameworks/ERJavaMail" />
        </antcall>
    </target>
    
    <!-- ERChangeNotificationJMS -->
    <target name="ERChangeNotificationJMS.all">
        <antcall target="framework" >
            <param name="project.principal.class" value="er.changenotification.ERCNNotificationCoordinator" />
            <param name="project.name" value="ERChangeNotificationJMS" />
            <param name="project.dir" value="${wonder.root}/Common/Frameworks/ERChangeNotificationJMS" />
        </antcall>
    </target>
    <target name="ERChangeNotificationJMS.clean">
        <antcall target="clean" >
            <param name="project.principal.class" value="er.changenotification.ERCNNotificationCoordinator" />
            <param name="project.name" value="ERChangeNotificationJMS" />
            <param name="project.dir" value="${wonder.root}/Common/Frameworks/ERChangeNotificationJMS" />
        </antcall>
    </target>

    <!-- ERNeutralLook -->
    <target name="ERNeutralLook.all">
        <antcall target="framework" >
            <param name="project.principal.class" value="" />
            <param name="project.name" value="ERNeutralLook" />
            <param name="project.dir" value="${wonder.root}/Common/Frameworks/ERNeutralLook" />
        </antcall>
    </target>
    <target name="ERNeutralLook.clean">
        <antcall target="clean" >
            <param name="project.principal.class" value="" />
            <param name="project.name" value="ERNeutralLook" />
            <param name="project.dir" value="${wonder.root}/Common/Frameworks/ERNeutralLook" />
        </antcall>
    </target>
    
    <!-- WOOgnl -->
    <target name="WOOgnl.all">
        <antcall target="framework" >
            <param name="project.principal.class" value="ognl.webobjects.WOOgnl" />
            <param name="project.name" value="WOOgnl" />
            <param name="project.dir" value="${wonder.root}/Common/Frameworks/WOOgnl" />
        </antcall>
    </target>
    <target name="WOOgnl.clean">
        <antcall target="clean" >
            <param name="project.principal.class" value="" />
            <param name="project.name" value="WOOgnl" />
            <param name="project.dir" value="${wonder.root}/Common/Frameworks/WOOgnl" />
        </antcall>
    </target>

    <!-- BTBusinessLogic -->
    <target name="BTBusinessLogic.all">
        <antcall target="framework" >
            <param name="project.principal.class" value="er.bugtracker.BTBusinessLogic" />
            <param name="project.name" value="BTBusinessLogic" />
            <param name="project.dir" value="${wonder.root}/Common/Applications/BugTracker/Frameworks/BTBusinessLogic" />
        </antcall>
    </target>
    <target name="BTBusinessLogic.clean">
        <antcall target="clean" >
            <param name="project.principal.class" value="er.bugtracker.BTBusinessLogic" />
            <param name="project.name" value="BTBusinessLogic" />
            <param name="project.dir" value="${wonder.root}/Common/Applications/BugTracker/Frameworks/BTBusinessLogic" />
        </antcall>
    </target>

    <!-- BugTracker -->
    <target name="BugTracker.all">
        <antcall target="application" >
            <param name="project.principal.class" value="er.bugtracker.Application" />
            <param name="project.name" value="BugTracker" />
            <param name="project.dir" value="${wonder.root}/Common/Applications/BugTracker" />
        </antcall>
    </target>
    <target name="BugTracker.clean">
        <antcall target="clean" >
            <param name="project.principal.class" value="er.bugtracker.Application" />
            <param name="project.name" value="BugTracker" />
            <param name="project.dir" value="${wonder.root}/Common/Applications/BugTracker" />
        </antcall>
    </target>

    <!-- D2WInspectExample -->
    <target name="D2WInspectExample.all">
        <antcall target="stepwiseApplication" >
            <param name="project.principal.class" value="Application" />
            <param name="project.name" value="D2WInspectExample" />
            <param name="project.dir" value="${wonder.root}/Common/Examples/Stepwise/D2WInspectExample" />
        </antcall>
    </target>
    <target name="D2WInspectExample.clean">
        <antcall target="clean" >
            <param name="project.principal.class" value="Application" />
            <param name="project.name" value="D2WInspectExample" />
            <param name="project.dir" value="${wonder.root}/Common/Examples/Stepwise/D2WInspectExample" />
        </antcall>
    </target>

    <!-- D2WListExample -->
    <target name="D2WListExample.all">
        <antcall target="stepwiseApplication" >
            <param name="project.principal.class" value="Application" />
            <param name="project.name" value="D2WListExample" />
            <param name="project.dir" value="${wonder.root}/Common/Examples/Stepwise/D2WListExample" />
        </antcall>
    </target>
    <target name="D2WListExample.clean">
        <antcall target="clean" >
            <param name="project.principal.class" value="Application" />
            <param name="project.name" value="D2WListExample" />
            <param name="project.dir" value="${wonder.root}/Common/Examples/Stepwise/D2WListExample" />
        </antcall>
    </target>


    <!-- NetStruxrCaseStudy -->
    <target name="NetStruxrCaseStudy.all">
        <antcall target="application" >
            <param name="project.principal.class" value="Application" />
            <param name="project.name" value="NetStruxrCaseStudy" />
            <param name="project.dir" value="${wonder.root}/Common/Examples/Wrox/NetStruxrCaseStudy" />
        </antcall>
    </target>
    <target name="NetStruxrCaseStudy.clean">
        <antcall target="clean" >
            <param name="project.principal.class" value="Application" />
            <param name="project.name" value="NetStruxrCaseStudy" />
            <param name="project.dir" value="${wonder.root}/Common/Examples/Wrox/NetStruxrCaseStudy" />
        </antcall>
    </target>
    
    <!-- ERMiniUglyLook -->
    <target name="ERMiniUglyLook.all">
        <antcall target="framework" >
            <param name="project.principal.class" value="" />
            <param name="project.name" value="ERMiniUglyLook" />
            <param name="project.dir" value="${wonder.root}/Common/Examples/Wrox/ERMiniUglyLook" />
        </antcall>
    </target>
    <target name="ERMiniUglyLook.clean">
        <antcall target="clean" >
            <param name="project.principal.class" value="Application" />
            <param name="project.name" value="ERMiniUglyLook" />
            <param name="project.dir" value="${wonder.root}/Common/Examples/Wrox/ERMiniUglyLook" />
        </antcall>
    </target>
    
    <target name="core.all" depends="ERJars.all, JavaWOExtensions.all, ERExtensions.all, ERDirectToWeb.all" />
    <target name="core.clean" depends="ERJars.clean, JavaWOExtensions.clean, ERExtensions.clean, ERDirectToWeb.clean" />

    <target name="frameworks.all" depends="core.all, ERNeutralLook.all, WOOgnl.all, ERCoreBusinessLogic.all, ERJavaMail.all, ERChangeNotificationJMS.all" />
    <target name="frameworks.clean" depends="core.clean, ERNeutralLook.clean, WOOgnl.clean, ERCoreBusinessLogic.clean, ERJavaMail.clean, ERChangeNotificationJMS.clean" />

    <target name="bugtracker.all" depends="frameworks.all, BTBusinessLogic.all, BugTracker.all" />
    <target name="bugtracker.clean" depends="BTBusinessLogic.clean, BugTracker.clean" />

    <target name="applications.all" depends="frameworks.all, bugtracker.all" />
    <target name="applications.clean" depends="bugtracker.clean" />

    <target name="wrox.all" depends="frameworks.all,ERMiniUglyLook.all, NetStruxrCaseStudy.all" />
    <target name="wrox.clean" depends="ERMiniUglyLook.clean, NetStruxrCaseStudy.clean" />

    <target name="stepwise.all" depends="D2WListExample.all ,D2WInspectExample.all" />
    <target name="stepwise.clean" depends="D2WListExample.clean, D2WInspectExample.clean" />

    <target name="examples.all" depends="frameworks.all, wrox.all, stepwise.all" />
    <target name="examples.clean" depends="wrox.clean, stepwise.clean" />

    <target name="common.all" depends="frameworks.all, applications.all, examples.all" />
    <target name="common.clean" depends="frameworks.clean, applications.clean, examples.clean" />

    <target name="all" depends="common.all" />
    <target name="all.clean" depends="common.clean" />

</project>
