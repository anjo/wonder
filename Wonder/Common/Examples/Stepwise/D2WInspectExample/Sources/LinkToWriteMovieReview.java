// Generated by the WebObjects Wizard Fri Nov 17 10:23:58 US/Pacific 2000

import com.webobjects.foundation.*;
import com.webobjects.appserver.*;
import com.webobjects.eocontrol.*;
import com.webobjects.eoaccess.*;
import com.webobjects.directtoweb.*;
import demo.eo.*;

public class LinkToWriteMovieReview extends WOComponent {

    public LinkToWriteMovieReview(WOContext aContext) {
        super(aContext);
    }

    public boolean isStateless() { return true; }

    public EOEnterpriseObject object() { return (EOEnterpriseObject)valueForBinding("object"); }
    public String key() { return (String)valueForBinding("key"); }

    public Movie movie() {
        return (Movie)(object() instanceof Movie ? object() : object().valueForKeyPath(key()));
    }

    public WOComponent writeReview() {
        // This will be a peer of the session's default editingContext.
        EOEditingContext peer = new EOEditingContext();
        // The bellow methods would be better suited in the business logic.  But for simplicity it it here.
        EOClassDescription cd = EOClassDescription.classDescriptionForEntityName("Review");
        EOEnterpriseObject review = cd.createInstanceWithEditingContext(peer,null);
        peer.insertObject(review);
        Movie localMovie = (Movie)EOUtilities.localInstanceOfObject(peer, movie());
        if (localMovie == null)
            throw new RuntimeException("Attempting to create a review for a null movie.");
        localMovie.addObjectToBothSidesOfRelationshipWithKey(review, "reviews");
        EditPageInterface epi = (EditPageInterface)D2W.factory().pageForConfigurationNamed("CreateReview", session());
        epi.setObject(review);
        epi.setNextPage(context().page());
        // Need to make sure that the ec survives, ie after the EOUtilities.localInstanceOfObject method the ec could be released.
        peer.hasChanges();
        return (WOComponent)epi;
    }
}
