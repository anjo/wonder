<?xml version="1.0"?>

<!-- ======================================================== -->
<!--     WONDER Documentation and website Ant build file      -->
<!--                                                          -->
<!-- Called from "build.xml", normally shouldn't be used as   --> 
<!-- a standalone buildfile.                                  -->
<!-- ======================================================== -->
<project name="wonder-doc" default="api" basedir="../..">

    <property file="Build/build/build.properties" />
    <property file="${user.home}/build.properties" />
    <property file="Build/build/default.properties" />

    <property name="wo.system.root" value="/System/Library/Frameworks" />
    <property name="build.root" value="${user.home}/Roots" />
    <property name="wonder.root" value="${basedir}" />

    <!-- ==================================================== -->
    <!--              Derived Properties.                     -->
    <!-- These properties are derived from other properties.  -->
    <!-- Normally, these should not be redefined.             -->
    <!-- ==================================================== -->
    <property name="dist" value="${dist.base}/${project.name}-${project.version}"/>
    
    <!-- ==================================================== -->
    <!--              CLASSPATH settings                      -->
    <!-- ==================================================== -->
    <path id="classpath">
        <fileset dir="Build/lib">
            <include name="cayenne.jar"/>
            <include name="jdom*.jar"/>
        </fileset>
            <fileset dir="${wo.system.root}">
                <include name="Java**/Resources/Java/*.jar" />
                <exclude name="JavaWOExtensions.framework"/>
                <exclude name="Java*Cocoa.framework"/>
                <exclude name="JavaOpen*.framework"/>
                <exclude name="JavaEOGeneration*.framework"/>
                <exclude name="JavaEOInterface.framework"/>
                <exclude name="JavaEODistribution.framework"/>
            </fileset>
            <fileset dir="${build.root}">
                <include name="ER*.framework/Resources/Java/*.jar" />
            </fileset>
            <fileset dir="${build.root}">
                <include name="BT*.framework/Resources/Java/*.jar" />
            </fileset>
    </path>
    
    <!-- ==================================================== -->
    <!-- Sets up distribution directories.                    -->
    <!-- ==================================================== -->
    <target name="prepare">
        <!-- Create the time stamp -->
        <tstamp>
            <format property="updated.date" pattern="EEE, MMM d, yyyy"/>
            <format property="updated.time" pattern="hh:mm aa z"/>
        </tstamp>
        <!-- Create directories -->
        <mkdir dir="${dist}"/>
        <mkdir dir="${dist}/Documentation"/>
        <mkdir dir="${dist}/Documentation/api"/>
    </target>


    <!-- ==================================================== -->
    <!-- Clean Wonder                                         -->
    <!-- ==================================================== -->
    <target name="clean">
        <delete dir="${dist}/Documentation"/>
    </target>


    <!-- ==================================================== -->
    <!-- Build Wonder documenatation.                         -->
    <!-- ==================================================== -->
    <target name="doc" depends="prepare, api">
        <taskdef name="anakia" classname="org.apache.velocity.anakia.AnakiaTask">
            <classpath refid="classpath"/>
        </taskdef>

        <!-- Build site -->
        <anakia basedir="Build/xdocs" destdir="${dist}/doc"
             extension=".html" style="wonder.vsl"
             projectFile="stylesheets/project.xml"
             excludes="**/stylesheets/**"
             includes="**/*.xml"
             lastModifiedCheck="true"
             templatePath="Build/xdocs/stylesheets">
        </anakia>

        <!-- copy resources -->
        <copy todir="${dist}/doc" filtering="no">
            <fileset dir="Build/xdocs">
                <include name="**/*.gif"/>
                <include name="**/*.jpeg"/>
                <include name="**/*.jpg"/>
                <include name="**/*.png"/>
                <include name="**/*.css"/>
            </fileset>
        </copy>
    </target>

    <!-- ========================================== -->
    <!-- Builds API documentation.                  -->
    <!-- ========================================== -->
    <target name="api" depends="prepare">
        <!--<copy todir="${dist}/doc">
            <fileset dir="doc">
                <include name="**/LICENSE*"/>
            </fileset>
        </copy>-->

        <javadoc   packagenames="er.*"
                   defaultexcludes="yes"
                   destdir="${dist}/Documentation/api"
                   author="true"
                   version="true"
                   use="true"
                   verbose="false"
                   windowtitle="Project Wonder Reference Documentation">

            <classpath refid="classpath"/>
            <sourcepath>
                <pathelement path="${wonder.root}/Common/Frameworks/ERExtensions/Sources/"/>
                <pathelement path="${wonder.root}/Common/Frameworks/ERDirectToWeb/Sources/"/>
                <pathelement path="${wonder.root}/Common/Frameworks/ERJavaMail/Sources/"/>
                <pathelement path="${wonder.root}/Common/Frameworks/ERChangeNotificationJMS/Sources/"/>
            </sourcepath>
            <doctitle><![CDATA[<h2>Project Wonder Reference Documentation</h2>]]></doctitle>
            <header><![CDATA[<em>Project Wonder ${project.version}</em>]]></header>
            <bottom><![CDATA[Copyright &#169; 2002 Project Wonder.]]></bottom>
            <footer><![CDATA[Last updated: ${updated.date} &#149; ${updated.time}]]></footer>
            <link href="http://java.sun.com/j2se/1.3/docs/api/"/>
            <link href="http://developer.apple.com/techpubs/webobjects/Reference/Javadoc/"/>
            <link href="http://jakarta.apache.org/log4j/docs/api/"/>
            <link href="http://www.junit.org/junit/javadoc/3.7/"/>
        </javadoc>
    </target>

</project>
