<?xml version="1.0"?>

<!-- ======================================================== -->
<!--     WONDER Documentation and website Ant build file      -->
<!--                                                          -->
<!-- Called from "build.xml", normally shouldn't be used as   --> 
<!-- a standalone buildfile.                                  -->
<!-- ======================================================== -->
<project name="wonder-doc" default="api" basedir="../..">

    <property name="wonder.root" value="${basedir}" />
    <property file="${wonder.root}/Build/build/build.properties" />
    <property file="${user.home}/build.wonder.properties" />
    <property file="${user.home}/build.properties" />
    <property file="${wonder.root}/Build/build/default.properties" />
    <property file="${wonder.root}/Build/build/${os.name}.properties" />
    <property file="${wonder.root}/Build/build/default-os.properties" />

    <property name="wo.woroot" value="/System" />
    <property name="build.root" value="${user.home}/Roots" />
    <property name="wo.localroot" value="/" />
    <property name="wo.frameworks" value="${wo.woroot}/Library/Frameworks" />
    <property name="wo.local.frameworks" value="${wo.wolocalroot}/Library/Frameworks" />
    <property name="build.classes" value="${build.root}/classes/${project.name}" />


    <!-- ==================================================== -->
    <!--              Derived Properties.                     -->
    <!-- These properties are derived from other properties.  -->
    <!-- Normally, these should not be redefined.             -->
    <!-- ==================================================== -->
    <property name="dist" value="${dist.base}/${project.name}-${project.version}"/>
    
    <!-- ==================================================== -->
    <!--              CLASSPATH settings                      -->
    <!-- ==================================================== -->
    <path id="classpath">
        <fileset dir="${wonder.root}/Build/lib">
            <include name="cayenne.jar"/>
            <include name="jdom*.jar"/>
        </fileset>
        <fileset dir="${wo.frameworks}">
            <include name="Java**/Resources/Java/*.jar" />
            <exclude name="JavaWOExtensions.framework"/>
            <exclude name="Java*Cocoa.framework"/>
            <exclude name="JavaOpen*.framework"/>
            <exclude name="JavaEOGeneration*.framework"/>
            <exclude name="JavaEOInterface.framework"/>
            <exclude name="JavaEODistribution.framework"/>
        </fileset>
        <fileset dir="${build.root}">
            <include name="*.framework/Resources/Java/*.jar" />
        </fileset>
    </path>
    
    <!-- ==================================================== -->
    <!-- Sets up distribution directories.                    -->
    <!-- ==================================================== -->
    <target name="prepare">
        <!-- Create the time stamp -->
        <tstamp>
            <format property="updated.date" pattern="EEE, MMM d, yyyy"/>
            <format property="updated.time" pattern="hh:mm aa z"/>
        </tstamp>
        <!-- Create directories -->
        <mkdir dir="${dist}"/>
        <mkdir dir="${dist}/Documentation"/>
        <mkdir dir="${dist}/Documentation/api"/>
    </target>


    <!-- ==================================================== -->
    <!-- Clean Wonder                                         -->
    <!-- ==================================================== -->
    <target name="clean">
        <delete dir="${dist}/Documentation"/>
    </target>


    <!-- ==================================================== -->
    <!-- Build Wonder documenatation.                         -->
    <!-- ==================================================== -->
    <target name="doc" depends="prepare, api">
        <taskdef name="anakia" classname="org.apache.velocity.anakia.AnakiaTask">
            <classpath refid="classpath"/>
        </taskdef>

        <!-- Build site -->
        <anakia basedir="${wonder.root}/Build/xdocs" destdir="${dist}/doc"
             extension=".html" style="wonder.vsl"
             projectFile="stylesheets/project.xml"
             excludes="**/stylesheets/**"
             includes="**/*.xml"
             lastModifiedCheck="true"
             templatePath="Build/xdocs/stylesheets">
        </anakia>

        <!-- copy resources -->
        <copy todir="${dist}/doc" filtering="no">
            <fileset dir="Build/xdocs">
                <include name="**/*.gif"/>
                <include name="**/*.jpeg"/>
                <include name="**/*.jpg"/>
                <include name="**/*.png"/>
                <include name="**/*.css"/>
            </fileset>
        </copy>

    </target>

    <!-- ========================================== -->
    <!-- Builds API documentation.                  -->
    <!-- ========================================== -->
    <target name="api" depends="prepare">
        <!-- copy README's -->
        <copy todir="${dist}/" flatten="true">
            <fileset dir="${wonder.root}">
                <include name="*.txt"/>
                <include name="**/LICENSE*"/>
            </fileset>
        </copy>

        <javadoc packagenames="er.*, com.gammastream.*, org.svgobjects.*, com.webobjects.jdbcadaptor.*, com.webobjects.woextensions.*"
                   defaultexcludes="yes"
                   destdir="${dist}/Documentation/api"
                   author="true"
                   version="true"
                   use="true"
                   verbose="false"
                   windowtitle="Project Wonder Reference Documentation">

            <classpath refid="classpath"/>
            <sourcepath>
                    <dirset dir="${wonder.root}">
                         <include name="**/Sources/" /> 
                         <exclude name="**/*Example*/**" /> 
                         <exclude name="**/Applications/**" /> 
                    </dirset>
                <!--pathelement path="${wonder.root}">
                </pathelement-->
            </sourcepath>
            <doctitle><![CDATA[<h2>Project Wonder Reference Documentation</h2>]]></doctitle>
            <header><![CDATA[<em>Project Wonder ${project.version}</em>]]></header>
            <bottom><![CDATA[Copyright &#169; 2002 &#8211; 2007  Project Wonder.]]></bottom>
            <footer><![CDATA[Last updated: ${updated.date} &#149; ${updated.time}]]></footer>
            <link href="http://java.sun.com/j2se/1.4/docs/api/"/>
            <link href="http://developer.apple.com/documentation/WebObjects/Reference/API/" packagelistLoc="${wonder.root}/Build/build/webobjects-package-list"/>
            <link href="http://jakarta.apache.org/log4j/docs/api/"/>
            <link href="http://www.junit.org/junit/javadoc/3.7/"/>
            <taglet name="BindingTaglet" path="${wonder.root}/Build/lib/" />
            <taglet name="D2WKeyTaglet" path="${wonder.root}/Build/lib/" />
        </javadoc>
    </target>

</project>
